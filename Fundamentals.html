
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fundamentals &#8212; mcvine 1.0 documentation</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
  </head><body>
<div class="header">  
<table><tr>
<!--
<td>
<div style="text-align: left; padding: 7px 7px 10px 10px">
<a href="index.html"><img src="_static/mcvine.png" border="0" alt="py4sci"
  height="80"/></a>
</div>
</td>
-->
<td style="">
<div class="banner">MCViNE: Monte Carlo VIrtual Neutron Experiment</div>
</td>
</tr>
</table>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="http://mcvine.org">MCViNE</a> &raquo; &nbsp;</li>
        <li><a href="index.html">Documentation</a> &raquo; &nbsp;</li>
        <li><a href="search.html">search</a> &raquo;</li>

        <li class="nav-item nav-item-this"><a href="">Fundamentals</a></li> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Fundamentals</a><ul>
<li><a class="reference internal" href="#instrument">Instrument</a><ul>
<li><a class="reference internal" href="#creat-instrument-simulation-applicatioin">Creat instrument simulation applicatioin</a></li>
<li><a class="reference internal" href="#positioning-of-components">Positioning of Components</a><ul>
<li><a class="reference internal" href="#relative-coordinates">Relative coordinates</a></li>
</ul>
</li>
<li><a class="reference internal" href="#options-of-instrument-simulation-app">Options of instrument simulation app</a><ul>
<li><a class="reference internal" href="#scattering">Scattering</a></li>
<li><a class="reference internal" href="#monte-carlo">Monte Carlo</a></li>
<li><a class="reference internal" href="#outputs">Outputs</a></li>
<li><a class="reference internal" href="#miscellanesous">Miscellanesous</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#using-tracer-to-debug">Using tracer to debug</a></li>
<li><a class="reference internal" href="#simulated-intensities">Simulated intensities</a></li>
<li><a class="reference internal" href="#list-of-available-neutron-components">List of available neutron components</a></li>
<li><a class="reference internal" href="#show-component-information">Show component information</a></li>
<li><a class="reference internal" href="#error-bar-of-simulated-intensities">Error bar of simulated intensities</a><ul>
<li><a class="reference internal" href="#basic-treatment">Basic treatment</a></li>
<li><a class="reference internal" href="#error-propagation">Error propagation</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/Fundamentals.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="fundamentals">
<span id="id1"></span><h1>Fundamentals<a class="headerlink" href="#fundamentals" title="Permalink to this headline">¶</a></h1>
<div class="section" id="instrument">
<span id="fundamentals-instrument"></span><h2>Instrument<a class="headerlink" href="#instrument" title="Permalink to this headline">¶</a></h2>
<div class="section" id="creat-instrument-simulation-applicatioin">
<h3>Creat instrument simulation applicatioin<a class="headerlink" href="#creat-instrument-simulation-applicatioin" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You may want to follow
<a class="reference internal" href="Tutorials-basics.html#create-sim-app"><span class="std std-ref">this tutorial</span></a>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Experimental: you could also create your simulation application online at
<a class="reference external" href="http://vnf-dev.caltech.edu/mcvine">http://vnf-dev.caltech.edu/mcvine</a></p>
</div>
<p>Create an instrument simulation application:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mcvine-create-instrument-simulation-application  --name=&lt;name&gt; --components=&lt;list of components&gt;
</pre></div>
</div>
</div>
<div class="section" id="positioning-of-components">
<span id="fundamentals-instrument-positioning-of-components"></span><h3>Positioning of Components<a class="headerlink" href="#positioning-of-components" title="Permalink to this headline">¶</a></h3>
<p>Positioning of components is done through the “geometer”:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">geometer</span><span class="o">.&lt;</span><span class="n">component</span><span class="o">&gt;=&lt;</span><span class="n">position</span><span class="o">&gt;</span><span class="p">,</span><span class="o">&lt;</span><span class="n">orientation</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">geometer</span><span class="o">.</span><span class="n">sample</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>The first tuple (0,0,10) means the position of the sample is at (0,0,10).
The second tuple (0,0,0) menas the orientation of the sample is the same
as the absolute coordinate system.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Coordinate system convention:</p>
<p>mcvine uses the same convention as mcstas.</p>
<ul class="simple">
<li><p>z – beam downstream</p></li>
<li><p>y – vertical up.</p></li>
</ul>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Units:</p>
<ul class="simple">
<li><p>position: meters</p></li>
<li><p>orientation: degrees</p></li>
</ul>
</div>
<div class="section" id="relative-coordinates">
<h4>Relative coordinates<a class="headerlink" href="#relative-coordinates" title="Permalink to this headline">¶</a></h4>
<p>A coomponent’s position and orientation can be specified as relative to another
component. For example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">geometer</span><span class="o">.</span><span class="n">sample</span><span class="o">=</span><span class="n">relative</span><span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">)),</span><span class="n">relative</span><span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
<p>means the sample is at (0,0,10) relative to the coordinate system attached to
the “source” component, and rotated 30 degrees by the y axis of the coordinate
system attached to the “source” component.</p>
<p>The reference component is specified by its name.</p>
<p>You can also use the keyword “previous” to mean the reference
component is the one just before this component in the pipeline.</p>
</div>
</div>
<div class="section" id="options-of-instrument-simulation-app">
<h3>Options of instrument simulation app<a class="headerlink" href="#options-of-instrument-simulation-app" title="Permalink to this headline">¶</a></h3>
<div class="section" id="scattering">
<h4>Scattering<a class="headerlink" href="#scattering" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>–multiple-scattering: indicates whether multiple scattering is on. This option
is only useful for the components that support this feature.</p></li>
</ul>
</div>
<div class="section" id="monte-carlo">
<h4>Monte Carlo<a class="headerlink" href="#monte-carlo" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>–ncount=&lt;n&gt;: number of simulation runs</p></li>
<li><p>–buffer_size=&lt;n&gt;: (optional) number of neutrons buffered in memory. By default a value will be picked for you depending on ncount and memory size.</p></li>
</ul>
</div>
<div class="section" id="outputs">
<h4>Outputs<a class="headerlink" href="#outputs" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>–overwrite-datafiles:
If on, existing outputs will be overwritten.</p></li>
<li><p>–output-dir=&lt;dir&gt;:
The output directory.</p></li>
</ul>
</div>
<div class="section" id="miscellanesous">
<h4>Miscellanesous<a class="headerlink" href="#miscellanesous" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>–journal.info.instrument: as simulation progress, print out information
regarding simulation loops and component processing loops.</p></li>
<li><p>–dump-pml:
Writes out pml file for the simulation. A pml file is a configuration file
that contains all configuration details of the simulation application.
When this option is on, no real simulation will be done.</p></li>
<li><p>–tracer:
facility to trace neutrons. By default, no tracer will be used. Choices:</p>
<ul>
<li><p>–tracer=console: print out neutrons to console. Be sure to turn down ncount.</p></li>
</ul>
</li>
<li><p>–mpirun.nodes=&lt;n&gt;:
Select the number of nodes to parallely run the simulation.
&lt;n&gt; is an integer.
This option is only valid if mpi binding of mcvine is available.</p></li>
</ul>
</div>
</div>
</div>
<div class="section" id="using-tracer-to-debug">
<span id="fundamentals-tracer"></span><h2>Using tracer to debug<a class="headerlink" href="#using-tracer-to-debug" title="Permalink to this headline">¶</a></h2>
<p>To see how neutrons move through the components,
use the “tracer” facility.</p>
<p>For example, if your simulation application is named “myapp”, please
try the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ /path/to/myapp --tracer=console --ncount=10
</pre></div>
</div>
<p>The simulation will print out the neutrons before they enter each
component and after they exit each component.</p>
</div>
<div class="section" id="simulated-intensities">
<span id="fundamentals-simulated-intensities"></span><h2>Simulated intensities<a class="headerlink" href="#simulated-intensities" title="Permalink to this headline">¶</a></h2>
<p>The simulated intensities at monitors are normalized by “ncount”,
the number of Monte Carlo runs.</p>
</div>
<div class="section" id="list-of-available-neutron-components">
<span id="fundamentals-list-of-components"></span><h2>List of available neutron components<a class="headerlink" href="#list-of-available-neutron-components" title="Permalink to this headline">¶</a></h2>
<p>To list all components:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mcvine component list
</pre></div>
</div>
<p>To list components of a specific category:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mcvine component list --category=monitors
</pre></div>
</div>
</div>
<div class="section" id="show-component-information">
<span id="fundamentals-component-info"></span><h2>Show component information<a class="headerlink" href="#show-component-information" title="Permalink to this headline">¶</a></h2>
<p>To find out more information about a component, run</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mcvine component info &lt;component-type&gt;
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mcvine component info E_monitor
</pre></div>
</div>
</div>
<div class="section" id="error-bar-of-simulated-intensities">
<h2>Error bar of simulated intensities<a class="headerlink" href="#error-bar-of-simulated-intensities" title="Permalink to this headline">¶</a></h2>
<div class="section" id="basic-treatment">
<span id="fundamentals-errorbar-basic"></span><h3>Basic treatment<a class="headerlink" href="#basic-treatment" title="Permalink to this headline">¶</a></h3>
<p>Here we examine the variance, or <span class="math notranslate nohighlight">\(\sigma^2\)</span> of the simulated
intensities at virtual monitors.</p>
<p>Let us think of a bin in a histogram gathered in a virtual monitor.
Say, in a virtual experiment that bin get the total intensity,
<span class="math notranslate nohighlight">\(I\)</span>,</p>
<div class="math notranslate nohighlight">
\[I = \sum p_i\]</div>
<p>where <span class="math notranslate nohighlight">\(p_i\)</span> is the probability of each neutron event recorded
in the target bin.
Our purpose here is to find the variance of the intensity <span class="math notranslate nohighlight">\(I\)</span>,
<span class="math notranslate nohighlight">\(Var(I)\)</span>, or <span class="math notranslate nohighlight">\(\sigma^2_I\)</span>.</p>
<p>First, let us think about this problem intuitively.
Apparantly with more events fall in to the target bin,
we expect the variance will reduce with respect to
the total intensity <span class="math notranslate nohighlight">\(I\)</span>. A good approximation would be that
the relative error, <span class="math notranslate nohighlight">\(\frac{\sigma_I}{I}\)</span>, will reduce
in the order of <span class="math notranslate nohighlight">\(\sqrt{N}\)</span>, where <span class="math notranslate nohighlight">\(N\)</span> is the
total number of events fall in the bin.</p>
<p>Now, let us try to do a quantitative treatment of this problem.
To start, let us not worry about the fact that the number
of events, <span class="math notranslate nohighlight">\(N\)</span>, is a result of random process. Let us assume
that <span class="math notranslate nohighlight">\(N\)</span> is a fixed number, and try to find out <span class="math notranslate nohighlight">\(Var(I)\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}Var_1(I) &amp;= Var(\sum p_i)    \\
       &amp;= \sum Var(p_i)      \\
       &amp;= N Var(\bar{p})\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\bar{p}\)</span> is the mean value of the collection
<span class="math notranslate nohighlight">\(\{p_i\}\)</span>, or <span class="math notranslate nohighlight">\(\bar{p}=\frac{1}{N}\sum{p_i}\)</span>.</p>
<p>The variance of <span class="math notranslate nohighlight">\(\bar{p}\)</span> can be estimated by</p>
<div class="math notranslate nohighlight">
\[\begin{split}Var(\bar{p}) &amp;= \frac{1}{N-1} \sum{(p_i-\bar{p})^2} \\
             &amp;= \frac{1}{N-1} (\sum p^2_i - \frac{1}{N} {(\sum p_i)}^2) \\
             &amp;= \frac{1}{N-1} (\sum p^2_i - N \bar{p}^2)\end{split}\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[Var_1(I) = \frac{N}{N-1} (\sum p^2_i - N \bar{p}^2)\]</div>
<p>Now, let us think about the effect of number of events being random.
The variance resulted from that can be estimated as</p>
<div class="math notranslate nohighlight">
\[\begin{split}Var_2(I) &amp;= Var(N) \times \bar{p}^2 \\
         &amp;= N \times \bar{p}^2\end{split}\]</div>
<p>So we have</p>
<div class="math notranslate nohighlight">
\[\begin{split}Var(I) &amp;= Var_1(I) + Var_2(I) \\
       &amp;= \frac{N}{N-1} (\sum{p_i^2} - \bar{p}^2)\end{split}\]</div>
<p>In most cases, this could be approximated as</p>
<div class="math notranslate nohighlight">
\[Var(I) = \sum{p_i^2}\]</div>
<p>To see if this is a reasonable estimate, let us consider a special case
in which most of <span class="math notranslate nohighlight">\(p_i\)</span> have similar value. In that case,</p>
<div class="math notranslate nohighlight">
\[\begin{split}Var(I) &amp;= \sum{\bar{p}^2} \\
       &amp;= N\bar{p}^2 = I^2/N\end{split}\]</div>
<p>or</p>
<div class="math notranslate nohighlight">
\[\begin{split}\frac{\sigma_I}{I} &amp;= \frac{\sqrt{Var(I)}}{I} \\
                   &amp;= \frac{1}{\sqrt{N}}\end{split}\]</div>
<p>which is consistent with our intuitive guess.</p>
<p>The error bar of the intensity is then</p>
<div class="math notranslate nohighlight">
\[Err(I) = \sqrt{Var(I)} = \sqrt{\sum{p_i^2}}\]</div>
<p>or</p>
<div class="math notranslate nohighlight">
\[Err^2(I) = \sum{p_i^2}\]</div>
</div>
<div class="section" id="error-propagation">
<span id="fundamentals-errorbar-errorprop"></span><h3>Error propagation<a class="headerlink" href="#error-propagation" title="Permalink to this headline">¶</a></h3>
<p>In the above discussion we assumed that the probablities
<span class="math notranslate nohighlight">\({p_i}\)</span> are computed precisely and have no errors
themselves.
But there are cases that <span class="math notranslate nohighlight">\({p_i}\)</span> itself has intrinsic errors.</p>
<p>In some cases, the intrinsic relative error can be seen as constant
among all computed events:</p>
<div class="math notranslate nohighlight">
\[\frac{Err_{intrinsic}(p_i)}{p_i} = \Delta_{intrinsic}\]</div>
<p>And the intensity, I, has therefore the same intrinsic relative error:</p>
<div class="math notranslate nohighlight">
\[\frac{Err_{intrinsic}(I)}{I} = \Delta_{intrinsic}\]</div>
<p>The total relative error considering the intrinsic error
and the error discussed above in <a class="reference internal" href="#fundamentals-errorbar-basic"><span class="std std-ref">Basic treatment</span></a>, is then</p>
<div class="math notranslate nohighlight">
\[\begin{split}{[\frac{Err(I)}{I}]}^2 &amp;= \frac{Var(I)}{I^2} + \Delta_{intrinsic}^2 \\
                       &amp;= \frac{\sum{p_i^2}}{I^2} + \Delta_{intrinsic}^2\end{split}\]</div>
<p>or</p>
<div class="math notranslate nohighlight">
\[Err^2(I) = \Delta_{intrinsic}^2 \times I^2  + \sum{p_i^2}\]</div>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li><a href="http://mcvine.org">MCViNE</a> &raquo; &nbsp;</li>
        <li><a href="index.html">Documentation</a> &raquo; &nbsp;</li>
        <li><a href="search.html">search</a> &raquo;</li>

        <li class="nav-item nav-item-this"><a href="">Fundamentals</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2006-2016, Jiao Lin, Michael Aivazis, and Brent Fultz.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.4.3.
    </div>
  </body>
</html>