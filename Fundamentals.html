<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Fundamentals &mdash; mcvine 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="mcvine 1.0 documentation" href="index.html" /> 
  </head>
  <body>
<div class="header">  
<table><tr>
<!--
<td>
<div style="text-align: left; padding: 7px 7px 10px 10px">
<a href="index.html"><img src="_static/mcvine.png" border="0" alt="py4sci"
  height="80"/></a>
</div>
</td>
-->
<td style="padding: 0pt 0pt 1em 1em;">
<h1 class="banner" style="color:white; font-size:2em; text-align:left">MCViNE</h1>
<h2 class="banner-note" style="color:lightgrey; font-size:1.5em; margin:0">Monte Carlo VIrtual Neutron Experiment</h2>
</td>
</tr>
</table>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="index.html">home</a>|&nbsp;</li>
        <li><a href="search.html">search</a>|&nbsp;</li>
        <li><a href="Documentation.html">MCViNE documentation</a> &raquo;</li>
 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Fundamentals</a><ul>
<li><a class="reference internal" href="#instrument">Instrument</a><ul>
<li><a class="reference internal" href="#creat-instrument-simulation-applicatioin">Creat instrument simulation applicatioin</a></li>
<li><a class="reference internal" href="#positioning-of-components">Positioning of Components</a><ul>
<li><a class="reference internal" href="#relative-coordinates">Relative coordinates</a></li>
</ul>
</li>
<li><a class="reference internal" href="#options-of-instrument-simulation-app">Options of instrument simulation app</a><ul>
<li><a class="reference internal" href="#scattering">Scattering</a></li>
<li><a class="reference internal" href="#monte-carlo">Monte Carlo</a></li>
<li><a class="reference internal" href="#outputs">Outputs</a></li>
<li><a class="reference internal" href="#miscellanesous">Miscellanesous</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#using-tracer-to-debug">Using tracer to debug</a></li>
<li><a class="reference internal" href="#simulated-intensities">Simulated intensities</a></li>
<li><a class="reference internal" href="#list-of-available-neutron-components">List of available neutron components</a></li>
<li><a class="reference internal" href="#show-component-information">Show component information</a></li>
<li><a class="reference internal" href="#error-bar-of-simulated-intensities">Error bar of simulated intensities</a><ul>
<li><a class="reference internal" href="#basic-treatment">Basic treatment</a></li>
<li><a class="reference internal" href="#error-propagation">Error propagation</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/Fundamentals.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="fundamentals">
<span id="id1"></span><h1>Fundamentals<a class="headerlink" href="#fundamentals" title="Permalink to this headline">¶</a></h1>
<div class="section" id="instrument">
<span id="fundamentals-instrument"></span><h2>Instrument<a class="headerlink" href="#instrument" title="Permalink to this headline">¶</a></h2>
<div class="section" id="creat-instrument-simulation-applicatioin">
<h3>Creat instrument simulation applicatioin<a class="headerlink" href="#creat-instrument-simulation-applicatioin" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You may want to follow
<a class="reference internal" href="Tutorials-basics.html#create-sim-app"><em>this tutorial</em></a>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Experimental: you could also create your simulation application online at
<a class="reference external" href="http://vnf-dev.caltech.edu/mcvine">http://vnf-dev.caltech.edu/mcvine</a></p>
</div>
<p>Create an instrument simulation application:</p>
<div class="highlight-python"><div class="highlight"><pre>$ mcvine-create-instrument-simulation-application  --name=&lt;name&gt; --components=&lt;list of components&gt;
</pre></div>
</div>
</div>
<div class="section" id="positioning-of-components">
<span id="fundamentals-instrument-positioning-of-components"></span><h3>Positioning of Components<a class="headerlink" href="#positioning-of-components" title="Permalink to this headline">¶</a></h3>
<p>Positioning of components is done through the &#8220;geometer&#8221;:</p>
<div class="highlight-python"><div class="highlight"><pre>--geometer.&lt;component&gt;=&lt;position&gt;,&lt;orientation&gt;
</pre></div>
</div>
<p>E.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="o">--</span><span class="n">geometer</span><span class="o">.</span><span class="n">sample</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>The first tuple (0,0,10) means the position of the sample is at (0,0,10).
The second tuple (0,0,0) menas the orientation of the sample is the same
as the absolute coordinate system.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Coordinate system convention:</p>
<p>mcvine uses the same convention as mcstas.</p>
<ul class="last simple">
<li>z &#8211; beam downstream</li>
<li>y &#8211; vertical up.</li>
</ul>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Units:</p>
<ul class="last simple">
<li>position: meters</li>
<li>orientation: degrees</li>
</ul>
</div>
<div class="section" id="relative-coordinates">
<h4>Relative coordinates<a class="headerlink" href="#relative-coordinates" title="Permalink to this headline">¶</a></h4>
<p>A coomponent&#8217;s position and orientation can be specified as relative to another
component. For example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="o">--</span><span class="n">geometer</span><span class="o">.</span><span class="n">sample</span><span class="o">=</span><span class="n">relative</span><span class="p">(</span><span class="s">&quot;source&quot;</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">)),</span><span class="n">relative</span><span class="p">(</span><span class="s">&quot;source&quot;</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
<p>means the sample is at (0,0,10) relative to the coordinate system attached to
the &#8220;source&#8221; component, and rotated 30 degrees by the y axis of the coordinate
system attached to the &#8220;source&#8221; component.</p>
<p>The reference component is specified by its name.</p>
<p>You can also use the keyword &#8220;previous&#8221; to mean the reference
component is the one just before this component in the pipeline.</p>
</div>
</div>
<div class="section" id="options-of-instrument-simulation-app">
<h3>Options of instrument simulation app<a class="headerlink" href="#options-of-instrument-simulation-app" title="Permalink to this headline">¶</a></h3>
<div class="section" id="scattering">
<h4>Scattering<a class="headerlink" href="#scattering" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>&#8211;multiple-scattering: indicates whether multiple scattering is on. This option
is only useful for the components that support this feature.</li>
</ul>
</div>
<div class="section" id="monte-carlo">
<h4>Monte Carlo<a class="headerlink" href="#monte-carlo" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>&#8211;ncount=&lt;n&gt;: number of simulation runs</li>
<li>&#8211;buffer_size=&lt;n&gt;: (optional) number of neutrons buffered in memory. By default a value will be picked for you depending on ncount and memory size.</li>
</ul>
</div>
<div class="section" id="outputs">
<h4>Outputs<a class="headerlink" href="#outputs" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>&#8211;overwrite-datafiles:
If on, existing outputs will be overwritten.</li>
<li>&#8211;output-dir=&lt;dir&gt;:
The output directory.</li>
</ul>
</div>
<div class="section" id="miscellanesous">
<h4>Miscellanesous<a class="headerlink" href="#miscellanesous" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>&#8211;journal.info.instrument: as simulation progress, print out information
regarding simulation loops and component processing loops.</li>
<li>&#8211;dump-pml:
Writes out pml file for the simulation. A pml file is a configuration file
that contains all configuration details of the simulation application.
When this option is on, no real simulation will be done.</li>
<li>&#8211;tracer:
facility to trace neutrons. By default, no tracer will be used. Choices:<ul>
<li>&#8211;tracer=console: print out neutrons to console. Be sure to turn down ncount.</li>
</ul>
</li>
<li>&#8211;mpirun.nodes=&lt;n&gt;:
Select the number of nodes to parallely run the simulation.
&lt;n&gt; is an integer.
This option is only valid if mpi binding of mcvine is available.</li>
</ul>
</div>
</div>
</div>
<div class="section" id="using-tracer-to-debug">
<span id="fundamentals-tracer"></span><h2>Using tracer to debug<a class="headerlink" href="#using-tracer-to-debug" title="Permalink to this headline">¶</a></h2>
<p>To see how neutrons move through the components,
use the &#8220;tracer&#8221; facility.</p>
<p>For example, if your simulation application is named &#8220;myapp&#8221;, please
try the following:</p>
<div class="highlight-python"><div class="highlight"><pre>$ /path/to/myapp --tracer=console --ncount=10
</pre></div>
</div>
<p>The simulation will print out the neutrons before they enter each
component and after they exit each component.</p>
</div>
<div class="section" id="simulated-intensities">
<span id="fundamentals-simulated-intensities"></span><h2>Simulated intensities<a class="headerlink" href="#simulated-intensities" title="Permalink to this headline">¶</a></h2>
<p>The simulated intensities at monitors are normalized by &#8220;ncount&#8221;,
the number of Monte Carlo runs.</p>
</div>
<div class="section" id="list-of-available-neutron-components">
<span id="fundamentals-list-of-components"></span><h2>List of available neutron components<a class="headerlink" href="#list-of-available-neutron-components" title="Permalink to this headline">¶</a></h2>
<p>To list all components:</p>
<div class="highlight-python"><div class="highlight"><pre>$ mcvine-list-components
</pre></div>
</div>
<p>To list components of a specific category:</p>
<div class="highlight-python"><div class="highlight"><pre>$ mcvine-list-components --category=monitors
</pre></div>
</div>
</div>
<div class="section" id="show-component-information">
<span id="fundamentals-component-info"></span><h2>Show component information<a class="headerlink" href="#show-component-information" title="Permalink to this headline">¶</a></h2>
<p>To find out more information about a component, run</p>
<div class="highlight-python"><div class="highlight"><pre>$ mcvine-component-info --type=&lt;component-type&gt;
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-python"><div class="highlight"><pre>$ mcvine-component-info --type=E_monitor
</pre></div>
</div>
</div>
<div class="section" id="error-bar-of-simulated-intensities">
<h2>Error bar of simulated intensities<a class="headerlink" href="#error-bar-of-simulated-intensities" title="Permalink to this headline">¶</a></h2>
<div class="section" id="basic-treatment">
<span id="fundamentals-errorbar-basic"></span><h3>Basic treatment<a class="headerlink" href="#basic-treatment" title="Permalink to this headline">¶</a></h3>
<p>Here we examine the variance, or <img class="math" src="_images/math/93c29bfedc993de115781b4fbb7e3a8b9e8d6b51.png" alt="\sigma^2"/> of the simulated
intensities at virtual monitors.</p>
<p>Let us think of a bin in a histogram gathered in a virtual monitor.
Say, in a virtual experiment that bin get the total intensity,
<img class="math" src="_images/math/5d9e7b2aec3287330051a115f2ea3cdc8c7a6587.png" alt="I"/>,</p>
<div class="math">
<p><img src="_images/math/7c0c96a7db24d65286b58bfc148074c61cf3dcde.png" alt="I = \sum p_i"/></p>
</div><p>where <img class="math" src="_images/math/be005a6163eb06f81800d3f41ee8408927fec9d7.png" alt="p_i"/> is the probability of each neutron event recorded
in the target bin.
Our purpose here is to find the variance of the intensity <img class="math" src="_images/math/5d9e7b2aec3287330051a115f2ea3cdc8c7a6587.png" alt="I"/>,
<img class="math" src="_images/math/61e3c085217149a11b6e2f6ffcad75f5c1cd3aed.png" alt="Var(I)"/>, or <img class="math" src="_images/math/83bc60902b5fdd90d23d243eee91c940eb0c6b8a.png" alt="\sigma^2_I"/>.</p>
<p>First, let us think about this problem intuitively.
Apparantly with more events fall in to the target bin,
we expect the variance will reduce with respect to
the total intensity <img class="math" src="_images/math/5d9e7b2aec3287330051a115f2ea3cdc8c7a6587.png" alt="I"/>. A good approximation would be that
the relative error, <img class="math" src="_images/math/94225bb3001fed6c3c996f4e41914bdab7b11e75.png" alt="\frac{\sigma_I}{I}"/>, will reduce
in the order of <img class="math" src="_images/math/50ad50e28cb8df4a48967b3a38d4e877901b2d1d.png" alt="\sqrt{N}"/>, where <img class="math" src="_images/math/75e27f04188974063be3230dca208cd495b77ce1.png" alt="N"/> is the
total number of events fall in the bin.</p>
<p>Now, let us try to do a quantitative treatment of this problem.
To start, let us not worry about the fact that the number
of events, <img class="math" src="_images/math/75e27f04188974063be3230dca208cd495b77ce1.png" alt="N"/>, is a result of random process. Let us assume
that <img class="math" src="_images/math/75e27f04188974063be3230dca208cd495b77ce1.png" alt="N"/> is a fixed number, and try to find out <img class="math" src="_images/math/61e3c085217149a11b6e2f6ffcad75f5c1cd3aed.png" alt="Var(I)"/>:</p>
<div class="math">
<p><img src="_images/math/04d87c1d92fe8c373234b673c790e3ba253148d1.png" alt="Var_1(I) &amp;= Var(\sum p_i)    \\
       &amp;= \sum Var(p_i)      \\
       &amp;= N Var(\bar{p})"/></p>
</div><p>where <img class="math" src="_images/math/eb8a40ad6909151b7a829368bb8e599735b957f9.png" alt="\bar{p}"/> is the mean value of the collection
<img class="math" src="_images/math/6d129086f518ea123b61cb71ac043a9bfc69e5e6.png" alt="\{p_i\}"/>, or <img class="math" src="_images/math/89f12fbb1a704244b1d0861aba19d71244a7a3a8.png" alt="\bar{p}=\frac{1}{N}\sum{p_i}"/>.</p>
<p>The variance of <img class="math" src="_images/math/eb8a40ad6909151b7a829368bb8e599735b957f9.png" alt="\bar{p}"/> can be estimated by</p>
<div class="math">
<p><img src="_images/math/4786e9aa573891849eef9a8a947ded392f350821.png" alt="Var(\bar{p}) &amp;= \frac{1}{N-1} \sum{(p_i-\bar{p})^2} \\
             &amp;= \frac{1}{N-1} (\sum p^2_i - \frac{1}{N} {(\sum p_i)}^2) \\
             &amp;= \frac{1}{N-1} (\sum p^2_i - N \bar{p}^2)"/></p>
</div><p>and</p>
<div class="math">
<p><img src="_images/math/291550d018f11fb1e0c251d91762642f9acd57b7.png" alt="Var_1(I) = \frac{N}{N-1} (\sum p^2_i - N \bar{p}^2)"/></p>
</div><p>Now, let us think about the effect of number of events being random.
The variance resulted from that can be estimated as</p>
<div class="math">
<p><img src="_images/math/08c3e323b6972d202deb5523366de01ad9edf9c3.png" alt="Var_2(I) &amp;= Var(N) \times \bar{p}^2 \\
         &amp;= N \times \bar{p}^2"/></p>
</div><p>So we have</p>
<div class="math">
<p><img src="_images/math/a6c46a891ddd0b733c485cf32dd02f5687d2a0a4.png" alt="Var(I) &amp;= Var_1(I) + Var_2(I) \\
       &amp;= \frac{N}{N-1} (\sum{p_i^2} - \bar{p}^2)"/></p>
</div><p>In most cases, this could be approximated as</p>
<div class="math">
<p><img src="_images/math/e835d5dc004fa5025acad65db044f36a66f3044c.png" alt="Var(I) = \sum{p_i^2}"/></p>
</div><p>To see if this is a reasonable estimate, let us consider a special case
in which most of <img class="math" src="_images/math/be005a6163eb06f81800d3f41ee8408927fec9d7.png" alt="p_i"/> have similar value. In that case,</p>
<div class="math">
<p><img src="_images/math/2ec7cb0466765b719ee74287b139cd8f71fc3d54.png" alt="Var(I) &amp;= \sum{\bar{p}^2} \\
       &amp;= N\bar{p}^2 = I^2/N"/></p>
</div><p>or</p>
<div class="math">
<p><img src="_images/math/e5450e7d0a18b6a119ebfb535bf064e8d5dc08da.png" alt="\frac{\sigma_I}{I} &amp;= \frac{\sqrt{Var(I)}}{I} \\
                   &amp;= \frac{1}{\sqrt{N}}"/></p>
</div><p>which is consistent with our intuitive guess.</p>
<p>The error bar of the intensity is then</p>
<div class="math">
<p><img src="_images/math/a522097349a2c7879eeaebd7edd163956765be16.png" alt="Err(I) = \sqrt{Var(I)} = \sqrt{\sum{p_i^2}}"/></p>
</div><p>or</p>
<div class="math">
<p><img src="_images/math/3eb8a677d89ce3a29feae4c14235fb5b3dfa8b2d.png" alt="Err^2(I) = \sum{p_i^2}"/></p>
</div></div>
<div class="section" id="error-propagation">
<span id="fundamentals-errorbar-errorprop"></span><h3>Error propagation<a class="headerlink" href="#error-propagation" title="Permalink to this headline">¶</a></h3>
<p>In the above discussion we assumed that the probablities
<img class="math" src="_images/math/dfe22104bbc01b1fd242ed7750d897c2a6e10ae3.png" alt="{p_i}"/> are computed precisely and have no errors
themselves.
But there are cases that <img class="math" src="_images/math/dfe22104bbc01b1fd242ed7750d897c2a6e10ae3.png" alt="{p_i}"/> itself has intrinsic errors.</p>
<p>In some cases, the intrinsic relative error can be seen as constant
among all computed events:</p>
<div class="math">
<p><img src="_images/math/f9ccc3d38f643517cec841a018990b3954c76265.png" alt="\frac{Err_{intrinsic}(p_i)}{p_i} = \Delta_{intrinsic}"/></p>
</div><p>And the intensity, I, has therefore the same intrinsic relative error:</p>
<div class="math">
<p><img src="_images/math/11ec396c1dfb2184527cc6692a50ee7e5e3abc3a.png" alt="\frac{Err_{intrinsic}(I)}{I} = \Delta_{intrinsic}"/></p>
</div><p>The total relative error considering the intrinsic error
and the error discussed above in <a class="reference internal" href="#fundamentals-errorbar-basic"><em>Basic treatment</em></a>, is then</p>
<div class="math">
<p><img src="_images/math/9026d58f30cf5cf603a0b0a56224878717b0bdac.png" alt="{[\frac{Err(I)}{I}]}^2 &amp;= \frac{Var(I)}{I^2} + \Delta_{intrinsic}^2 \\
                       &amp;= \frac{\sum{p_i^2}}{I^2} + \Delta_{intrinsic}^2"/></p>
</div><p>or</p>
<div class="math">
<p><img src="_images/math/e6c3056805a863d6855d11214d68c4829165c601.png" alt="Err^2(I) = \Delta_{intrinsic}^2 \times I^2  + \sum{p_i^2}"/></p>
</div></div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li><a href="index.html">home</a>|&nbsp;</li>
        <li><a href="search.html">search</a>|&nbsp;</li>
        <li><a href="Documentation.html">MCViNE documentation</a> &raquo;</li>
 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2006-2015, Jiao Lin, Michael Aivazis, and Brent Fultz.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>