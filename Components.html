<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Components &mdash; mcvine 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="mcvine 1.0 documentation" href="index.html" /> 
  </head>
  <body role="document">
<div class="header">  
<table><tr>
<!--
<td>
<div style="text-align: left; padding: 7px 7px 10px 10px">
<a href="index.html"><img src="_static/mcvine.png" border="0" alt="py4sci"
  height="80"/></a>
</div>
</td>
-->
<td style="">
<div class="banner">MCViNE: Monte Carlo VIrtual Neutron Experiment</div>
</td>
</tr>
</table>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="http://mcvine.org">MCViNE</a> &raquo; &nbsp;</li>
        <li><a href="index.html">Documentation</a> &raquo; &nbsp;</li>
        <li><a href="search.html">search</a> &raquo;</li>
 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Components</a><ul>
<li><a class="reference internal" href="#generic-components-provided-by-mcvine">Generic components provided by MCViNE</a><ul>
<li><a class="reference internal" href="#ndmonitor">NDMonitor</a><ul>
<li><a class="reference internal" href="#examples">Examples</a></li>
<li><a class="reference internal" href="#quick-tutorial">Quick tutorial</a></li>
</ul>
</li>
<li><a class="reference internal" href="#monochromatic-source">Monochromatic source</a><ul>
<li><a class="reference internal" href="#id3">Quick tutorial</a></li>
</ul>
</li>
<li><a class="reference internal" href="#neutron-printer">Neutron printer</a><ul>
<li><a class="reference internal" href="#id4">Quick tutorial</a></li>
</ul>
</li>
<li><a class="reference internal" href="#neutron-storage">Neutron storage</a><ul>
<li><a class="reference internal" href="#example-usages">Example usages</a></li>
<li><a class="reference internal" href="#tools">Tools</a><ul>
<li><a class="reference internal" href="#count-neutrons-in-a-storage-mcvine-neutron-storage-count-neutrons">Count neutrons in a storage &#8211; &#8220;mcvine-neutron-storage-count-neutrons&#8221;</a></li>
<li><a class="reference internal" href="#compute-total-intensity-in-a-storage-mcvine-neutron-storage-total-intensity">Compute total intensity in a storage &#8211; &#8220;mcvine-neutron-storage-total-intensity&#8221;</a></li>
<li><a class="reference internal" href="#merge-neutron-storages-mcvine-neutron-storage-merge">Merge neutron storages &#8211; &#8220;mcvine-neutron-storage-merge&#8221;</a></li>
<li><a class="reference internal" href="#print-neutrons-mcvine-neutron-storage-print-neutrons">Print neutrons &#8211; &#8220;mcvine-neutron-storage-print-neutrons&#8221;</a></li>
</ul>
</li>
<li><a class="reference internal" href="#error-propagation-when-using-neutron-storage">Error propagation when using neutron storage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#detector-system">Detector System</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mcstas-component-librarry">McStas component librarry</a><ul>
<li><a class="reference internal" href="#user-defined-mcstas-components">User-defined mcstas components</a></li>
</ul>
</li>
<li><a class="reference internal" href="#vitess-component-librarry">Vitess component librarry</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/Components.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="components">
<span id="id1"></span><h1>Components<a class="headerlink" href="#components" title="Permalink to this headline">¶</a></h1>
<div class="section" id="generic-components-provided-by-mcvine">
<h2>Generic components provided by MCViNE<a class="headerlink" href="#generic-components-provided-by-mcvine" title="Permalink to this headline">¶</a></h2>
<div class="section" id="ndmonitor">
<span id="id2"></span><h3>NDMonitor<a class="headerlink" href="#ndmonitor" title="Permalink to this headline">¶</a></h3>
<p>NDMonitor is a rectangular monitor with a finite size (width and height)
and infinitisimal thickness.
It can be used to measure a multi-dimensional histogram
of intensities.
The quantities to measure can be specify through command line.</p>
<div class="section" id="examples">
<h4>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>I(tof): &#8211;monitor=NDMonitor(tof)</li>
<li>I(energy): &#8211;monitor=NDMonitor(energy)</li>
<li>I(x,y):  &#8211;monitor=NDMonitor(x,y)</li>
<li>I(x,divergence of x): &#8211;monitor=NDMonitor(x, divx)</li>
<li>I(x,y,tof):  &#8211;monitor=NDMonitor(x,y,tof)</li>
</ul>
</div>
<div class="section" id="quick-tutorial">
<h4>Quick tutorial<a class="headerlink" href="#quick-tutorial" title="Permalink to this headline">¶</a></h4>
<p>Create an instrument simulation application:</p>
<div class="highlight-python"><div class="highlight"><pre>$ mcvine-create-instrument-simulation-application --name=sd --components=source,detector
</pre></div>
</div>
<p>Assign components:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ./sd --source=Source_simple --detector=&quot;NDMonitor(energy)&quot;  --dump-pml
</pre></div>
</div>
<p>Configure:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ./sd \
--geometer.detector=&quot;(0,0,10),(0,0,0)&quot; \
--source.width=0.1 --source.height=0.1 --source.radius=0 \
--source.xw=0.1 --source.yh=0.1 --source.dist=10 \
--source.E0=100 --source.dE=20 \
--detector.title=&quot;I(E)&quot; --detector.yheight=0.1 --detector.xwidth=0.1 \
--detector.nenergy=100 --detector.energymin=60 --detector.energymax=140 \
--dump-pml
</pre></div>
</div>
<p>Run:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ./sd --ncount=1e5
</pre></div>
</div>
<p>See result:</p>
<div class="highlight-python"><div class="highlight"><pre>$ PlotHist.py out/ienergy.h5
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/ndmonitor-ie.png"><img alt="_images/ndmonitor-ie.png" src="_images/ndmonitor-ie.png" style="width: 50%;" /></a>
</div>
</div>
<div class="section" id="monochromatic-source">
<span id="monochromaticsource"></span><h3>Monochromatic source<a class="headerlink" href="#monochromatic-source" title="Permalink to this headline">¶</a></h3>
<p>This is a neutron source that always generates the same neutron.
It exists mostly for debugging purpose.</p>
<div class="section" id="id3">
<h4>Quick tutorial<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<p>Create an instrument simulation application:</p>
<div class="highlight-python"><div class="highlight"><pre>$ mcvine-create-instrument-simulation-application --name=sd --components=source,detector
</pre></div>
</div>
<p>Assign components and configure:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ./sd \
--source=MonochromaticSource --source.energy=70 \
--detector=E_monitor --detector.filename=IE.dat \
--dump-pml
</pre></div>
</div>
<p>Run:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ./sd --ncount=1e3
</pre></div>
</div>
<p>See result:</p>
<div class="highlight-python"><div class="highlight"><pre>$ PlotHist.py out/IE.h5
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/monosource-ie.png"><img alt="_images/monosource-ie.png" src="_images/monosource-ie.png" style="width: 50%;" /></a>
</div>
</div>
<div class="section" id="neutron-printer">
<span id="neutronprinter"></span><h3>Neutron printer<a class="headerlink" href="#neutron-printer" title="Permalink to this headline">¶</a></h3>
<p>Neutron printer can be used to print out neutrons in the beam.
Actually this can be better achieved by uing
<a class="reference internal" href="Fundamentals.html#fundamentals-tracer"><span>the tracer</span></a>.</p>
<div class="section" id="id4">
<h4>Quick tutorial<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<p>Create an instrument simulation application:</p>
<div class="highlight-python"><div class="highlight"><pre>$ mcvine-create-instrument-simulation-application --name=sd --components=source,detector
</pre></div>
</div>
<p>Assign components:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ./sd --source=Source_simple --detector=&quot;NeutronPrinter&quot;  --dump-pml
</pre></div>
</div>
<p>Run:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ./sd --ncount=5
</pre></div>
</div>
</div>
</div>
<div class="section" id="neutron-storage">
<span id="neutronstorage"></span><h3>Neutron storage<a class="headerlink" href="#neutron-storage" title="Permalink to this headline">¶</a></h3>
<p>In mcvine, you can save neutrons to a neutron storage, and
reuse it in later simulations.</p>
<p>Following components are created for this purpose:</p>
<ul class="simple">
<li>NeutronFromStorage: retrieve neutrons from a storage and send them running</li>
<li>NeutronToStorage: save neutrons in simulation to a storage</li>
</ul>
<div class="section" id="example-usages">
<h4>Example usages<a class="headerlink" href="#example-usages" title="Permalink to this headline">¶</a></h4>
<p>1. Separate simulations of ARCS beam and sample scattering
Simulation of an ARCS experiment can be done in two steps.
The first step is to simulation the neutron component chain
down to the sample position:</p>
<div class="highlight-python"><div class="highlight"><pre>moderator -&gt; core-vessel-insert -&gt; shutter-guide -&gt; guide-1 -&gt;
  ... -&gt; fermi-chopper -&gt; ... -&gt; guide-5 -&gt; neutron-to-storage
</pre></div>
</div>
<p>Result of the first simulation step is a data file that contains
all the neutrons reach the sample position.
Those neutrons can be reused in various futher simulations.</p>
<p>For example we can simulate the scattering of neutrons from sample:</p>
<div class="highlight-python"><div class="highlight"><pre>neutron-from-storage -&gt; sample -&gt; arcs-detector-system
</pre></div>
</div>
<p>We can use different samples in different simulations that all
use the neutrons from the same neutron storage.</p>
<p>We could also put various monitors to examine the neutrons
in the storage:</p>
<div class="highlight-python"><div class="highlight"><pre>neutron-from-storage -&gt; monitor
</pre></div>
</div>
</div>
<div class="section" id="tools">
<h4>Tools<a class="headerlink" href="#tools" title="Permalink to this headline">¶</a></h4>
<div class="section" id="count-neutrons-in-a-storage-mcvine-neutron-storage-count-neutrons">
<h5>Count neutrons in a storage &#8211; &#8220;mcvine-neutron-storage-count-neutrons&#8221;<a class="headerlink" href="#count-neutrons-in-a-storage-mcvine-neutron-storage-count-neutrons" title="Permalink to this headline">¶</a></h5>
<p>Signature:</p>
<div class="highlight-python"><div class="highlight"><pre>$ mcvine-neutron-storage-count-neutrons &lt;neutron-file&gt;
</pre></div>
</div>
<ul class="simple">
<li>Input: a neutron file</li>
<li>Output: Number of neutrons in the given storage</li>
</ul>
</div>
<div class="section" id="compute-total-intensity-in-a-storage-mcvine-neutron-storage-total-intensity">
<h5>Compute total intensity in a storage &#8211; &#8220;mcvine-neutron-storage-total-intensity&#8221;<a class="headerlink" href="#compute-total-intensity-in-a-storage-mcvine-neutron-storage-total-intensity" title="Permalink to this headline">¶</a></h5>
<p>Signature:</p>
<div class="highlight-python"><div class="highlight"><pre>$ mcvine-neutron-storage-total-intensity &lt;neutron-file&gt;
</pre></div>
</div>
<ul class="simple">
<li>Input: a neutron file</li>
<li>Output: Total neutron intensity in the given storage</li>
</ul>
</div>
<div class="section" id="merge-neutron-storages-mcvine-neutron-storage-merge">
<h5>Merge neutron storages &#8211; &#8220;mcvine-neutron-storage-merge&#8221;<a class="headerlink" href="#merge-neutron-storages-mcvine-neutron-storage-merge" title="Permalink to this headline">¶</a></h5>
<p>Signature:</p>
<div class="highlight-python"><div class="highlight"><pre>$ mcvine-neutron-storage-merge \
    -files=&lt;neutron-files-to-merge&gt; \
    -output=&lt;output-neutron-file&gt;
</pre></div>
</div>
<ul class="simple">
<li>Input: neutron file(s)</li>
<li>Output: merged neutron file</li>
</ul>
</div>
<div class="section" id="print-neutrons-mcvine-neutron-storage-print-neutrons">
<h5>Print neutrons &#8211; &#8220;mcvine-neutron-storage-print-neutrons&#8221;<a class="headerlink" href="#print-neutrons-mcvine-neutron-storage-print-neutrons" title="Permalink to this headline">¶</a></h5>
<p>Signature:</p>
<div class="highlight-python"><div class="highlight"><pre>$ mcvine-neutron-storage-print-neutrons \
    -filename=&lt;neutron-file&gt; \
    -n=&lt;number-of-neutrons&gt;
</pre></div>
</div>
<ul class="simple">
<li>Input: neutron file(s)</li>
<li>Output: merged neutron file</li>
</ul>
</div>
</div>
<div class="section" id="error-propagation-when-using-neutron-storage">
<h4>Error propagation when using neutron storage<a class="headerlink" href="#error-propagation-when-using-neutron-storage" title="Permalink to this headline">¶</a></h4>
<p>When we use neutron storage, we need to make sure the
neutrons saved in the storage have enough statistics
for the simulations that use the storage to be successful.</p>
<p>As discussed in <a class="reference internal" href="Fundamentals.html#fundamentals-errorbar-errorprop"><span>Error propagation</span></a>,
the error bar of simulated intensity of a simulation using neutron storage
is given by</p>
<div class="math">
\[Err^2(I) = \Delta^2_{intrinsic} \times I^2  + \sum{p_i^2}\]</div>
<p>and the instrinsic error induced by using the neutron
storage could be approximated from the data of the simulation
that generated the neutron storage:</p>
<div class="math">
\[\Delta^2_{instrinsic} = \sum p_{ns, i}^2 / (\sum p_{ns, i})^2\]</div>
<p>where the subscript &#8220;<span class="math">\(ns\)</span>&#8221; denotes the simulation that generates
the neutron storage.</p>
<p>You can see that the errobar of a simulation involves a neutron
source that replays neutrons in a neutron storage is limited by
the error bar of the simulation that leads to the neutron storage.
So the rule of thumb of using neutron storage is that
it is necessary to make sure to have a reasonably good statistics
for the simulation of the neutron storage before using it for
other simulations.</p>
</div>
</div>
<div class="section" id="detector-system">
<span id="detectorsystem"></span><h3>Detector System<a class="headerlink" href="#detector-system" title="Permalink to this headline">¶</a></h3>
<p>DetectorSystemFromXml.</p>
<p>To see the events in an events file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">mccomponents.detector.event_utils</span> <span class="kn">import</span> <span class="n">readEvents</span>
<span class="n">events</span> <span class="o">=</span> <span class="n">readEvents</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
<span class="k">print</span> <span class="n">events</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="mcstas-component-librarry">
<span id="mcstas-comp-lib"></span><h2>McStas component librarry<a class="headerlink" href="#mcstas-component-librarry" title="Permalink to this headline">¶</a></h2>
<p>MCViNE is teamed with
<a class="reference external" href="http://mcstas.org">McStas</a> project to provide
access to McStas components from mcvine.
If you run:</p>
<div class="highlight-python"><div class="highlight"><pre>$ mcvine component list
</pre></div>
</div>
<p>you will see a lot of components coming from mcstas, for example &#8220;Monitor_4PI&#8221;.
You can use it like any other mcvine components:</p>
<div class="highlight-python"><div class="highlight"><pre>$ &lt;simapp&gt; --monitor=Monitor_4PI --dump-pml
</pre></div>
</div>
<p>For more details on any McStas component (e.g. Monitor_4PI),
you can use the mcvine command line interface:</p>
<div class="highlight-python"><div class="highlight"><pre>$ mcvine component info Monitor_4PI
</pre></div>
</div>
<p>Or you can visit the McStas documentation at
<a class="reference external" href="http://mcstas.org/documentation/">http://mcstas.org/documentation/</a></p>
<div class="section" id="user-defined-mcstas-components">
<span id="id5"></span><h3>User-defined mcstas components<a class="headerlink" href="#user-defined-mcstas-components" title="Permalink to this headline">¶</a></h3>
<p>It is not unusual that a user wants to use a mcstas component he
writes himself. To use a user-defined mcstas component, run:</p>
<div class="highlight-python"><div class="highlight"><pre>$ mcvine mcstas compilecomponent --filename=&lt;user-defined-component-file&gt; --category=&lt;category.&gt;
</pre></div>
</div>
<p>Here, &lt;user-defined-component-file&gt; is the path to the mcstas component file
you created, &lt;category&gt; is the category this component belongs to.
For example:</p>
<div class="highlight-python"><div class="highlight"><pre>$ mcvine mcstas compilecomponent --filename=Al_window.comp --category=optics
</pre></div>
</div>
<p>and mcvine will start compiling the component and put it into the system.
If the compiling failed, please don&#8217;t hesitate to post your questions
to <a class="reference external" href="mailto:mcvine-users&#37;&#52;&#48;googlegroups&#46;com">mcvine-users<span>&#64;</span>googlegroups<span>&#46;</span>com</a></p>
<p>If everything goes smoothly, now you can use this component just like any other components:</p>
<div class="highlight-python"><div class="highlight"><pre>$ mcvine component info Al_window
</pre></div>
</div>
</div>
</div>
<div class="section" id="vitess-component-librarry">
<span id="vitess-comp-lib"></span><h2>Vitess component librarry<a class="headerlink" href="#vitess-component-librarry" title="Permalink to this headline">¶</a></h2>
<p>This is still experimental.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li><a href="http://mcvine.org">MCViNE</a> &raquo; &nbsp;</li>
        <li><a href="index.html">Documentation</a> &raquo; &nbsp;</li>
        <li><a href="search.html">search</a> &raquo;</li>
 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2006-2016, Jiao Lin, Michael Aivazis, and Brent Fultz.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
  </body>
</html>