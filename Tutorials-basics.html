
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tutorials – basics &#8212; mcvine 1.0 documentation</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
  </head><body>
<div class="header">  
<table><tr>
<!--
<td>
<div style="text-align: left; padding: 7px 7px 10px 10px">
<a href="index.html"><img src="_static/mcvine.png" border="0" alt="py4sci"
  height="80"/></a>
</div>
</td>
-->
<td style="">
<div class="banner">MCViNE: Monte Carlo VIrtual Neutron Experiment</div>
</td>
</tr>
</table>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="http://mcvine.org">MCViNE</a> &raquo; &nbsp;</li>
        <li><a href="index.html">Documentation</a> &raquo; &nbsp;</li>
        <li><a href="search.html">search</a> &raquo;</li>

        <li class="nav-item nav-item-this"><a href="">Tutorials – basics</a></li> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Tutorials – basics</a><ul>
<li><a class="reference internal" href="#create-and-run-your-instrument-simulation-application">Create and run your instrument simulation application</a><ul>
<li><a class="reference internal" href="#create-instrument-simulation-application">Create instrument simulation application</a><ul>
<li><a class="reference internal" href="#instrument-consists-of-a-list-of-components">Instrument consists of a list of components</a></li>
</ul>
</li>
<li><a class="reference internal" href="#types-of-components">Types of components</a></li>
<li><a class="reference internal" href="#positions-of-components">Positions of components</a></li>
<li><a class="reference internal" href="#configurations-of-components">Configurations of components</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/Tutorials-basics.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="tutorials-basics">
<span id="id1"></span><h1>Tutorials – basics<a class="headerlink" href="#tutorials-basics" title="Permalink to this headline">¶</a></h1>
<div class="section" id="create-and-run-your-instrument-simulation-application">
<span id="create-sim-app"></span><h2>Create and run your instrument simulation application<a class="headerlink" href="#create-and-run-your-instrument-simulation-application" title="Permalink to this headline">¶</a></h2>
<p>By going through this tutorial you can get to know</p>
<ul class="simple">
<li><p>the structure
of mcvine instrument simulation application and the component chain</p></li>
<li><p>utilities to find out about available neutron component</p></li>
<li><p>options that affect behavior of instrument simulations</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Experimental: you could also create your simulation application online at
<a class="reference external" href="http://vnf-dev.caltech.edu/mcvine">http://vnf-dev.caltech.edu/mcvine</a></p>
</div>
<div class="section" id="create-instrument-simulation-application">
<h3>Create instrument simulation application<a class="headerlink" href="#create-instrument-simulation-application" title="Permalink to this headline">¶</a></h3>
<p>The command in mcvine to create an instrument simulation application
is “mcvine-create-instrument-simulation-application”.
To start, try</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mcvine-create-instrument-simulation-application -h
</pre></div>
</div>
<p>It will prints out some simple help about how to run this command.</p>
<div class="section" id="instrument-consists-of-a-list-of-components">
<h4>Instrument consists of a list of components<a class="headerlink" href="#instrument-consists-of-a-list-of-components" title="Permalink to this headline">¶</a></h4>
<p>To create a mcvine simulation application named “test” with two components, source and monitor,
do</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mcvine-create-instrument-simulation-application  --name=test --components=source,monitor
</pre></div>
</div>
<p>A python application will be created and named “test”.</p>
<p>You can find out how to run this simulation application by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./test -h
</pre></div>
</div>
<p>which outputs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>------------------------------------------------------------
* Instrument simulation application &#39;test&#39;
------------------------------------------------------------
* Sequence of components:
   [source] --&gt; [monitor]
------------------------------------------------------------
* Command:
 $ test  \
  --multiple-scattering=&lt;if true, enable multiple scattering&gt; \
  --buffer_size=&lt;size of neutron buffer. This is for optimizing the preformance of the simulation. When it is too large, it will occupy too much memory. When it is too small, the simulation will be slow. If you are not sure, please just leave it unset so that the default value will be used.&gt; \
  --output-dir=&lt;output directory&gt; \
  --ncount=&lt;number of total neutrons generated by source&gt; \
  --overwrite-datafiles=&lt;overwrite data files?&gt; \
  --geometer.source=&lt;position&gt;,&lt;orientation&gt; \
  --geometer.monitor=&lt;position&gt;,&lt;orientation&gt; \
  --source=&lt;component type&gt; \
  --monitor=&lt;component type&gt;
------------------------------------------------------------
</pre></div>
</div>
<p>Now, you can run this instrument by specifying more details of the instrument.
For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./test --source=MonochromaticSource --monitor=E_monitor
</pre></div>
</div>
<p>will run a simulation of an instrument with two components:</p>
<ul class="simple">
<li><p>source: MonochromaticSource</p></li>
<li><p>monitor: E_monitor</p></li>
</ul>
<p>You can save your configuration of the simulation application to a file so that
it is easier to rerun it. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./test --source=MonochromaticSource --monitor=E_monitor --dump-pml
</pre></div>
</div>
<p>will create a file “test.pml” in the current working directory.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A pml file generated by the –dump-pml command line option
contains the most current simulation configuraton.
With its existence in the working directory, you can
further fine-tune your simulation configuration and/or run it.
A pml file is a xml file and it is quite easy to read using
any text viewer/editor.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you run –dump-pml again,
the old “test.pml” will be copied to a file named like “test.pml.saved-&lt;time&gt;”,
and the “test.pml” will be overwritten.</p>
</div>
<p>With this configuration file at the current working directory, you don’t
need to specify the same configuration again. For example, this command</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./test -h
</pre></div>
</div>
<p>now gives the following help message that includes knowledge
of what the types of the components in the instrument component chain
are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>------------------------------------------------------------
* Instrument simulation application &#39;test&#39;
------------------------------------------------------------
* Sequence of components:
   [source(sources/MonochromaticSource)] --&gt; [monitor(monitors/E_monitor)]
------------------------------------------------------------
* Command:
 $ test  \
  --multiple-scattering=&lt;if true, enable multiple scattering&gt; \
  --buffer_size=&lt;size of neutron buffer. This is for optimizing the preformance of the simulation. When it is too large, it will occupy too much memory. When it is too small, the simulation will be slow. If you are not sure, please just leave it unset so that the default value will be used.&gt; \
  --output-dir=&lt;output directory&gt; \
  --ncount=&lt;number of total neutrons generated by source&gt; \
  --overwrite-datafiles=&lt;overwrite data files?&gt; \
  --geometer.source=&lt;position&gt;,&lt;orientation&gt; \
  --geometer.monitor=&lt;position&gt;,&lt;orientation&gt; \
  --source=&lt;component type&gt; \
  --monitor=&lt;component type&gt; \
  --source.probability=&lt;probabliity of neutrons. unit: 1&gt; \
  --source.position=&lt;position of neutrons. unit: m&gt; \
  --source.energy=&lt;energy of the neutron. if &quot;energy&quot; is given, the neutron velocity will be computed so that the energy of the neutron will be the given value of energy,and the moving direction will be determined by the &quot;velocity&quot; vector&gt; \
  --source.time=&lt;time of flight for neutrons. unit: s&gt; \
  --source.velocity=&lt;velocity of neutrons. unit: m/s. Note: if energy is nonzero, the magnitude of the velocity is set by energy&gt; \
  --monitor.Emin=&lt;Minimum energy to detect (meV) &gt; \
  --monitor.Emax=&lt;Maximum energy to detect (meV) &gt; \
  --monitor.filename=&lt;Name of file in which to store the detector image (text) &gt; \
  --monitor.nchan=&lt;Number of energy channels (1) &gt; \
  --monitor.xmax=&lt;Upper x bound of detector opening (m) &gt; \
  --monitor.xmin=&lt;Lower x bound of detector opening (m) &gt; \
  --monitor.ymin=&lt;Lower y bound of detector opening (m) &gt; \
  --monitor.ymax=&lt;Upper y bound of detector opening (m) &gt;
------------------------------------------------------------
</pre></div>
</div>
</div>
</div>
<div class="section" id="types-of-components">
<h3>Types of components<a class="headerlink" href="#types-of-components" title="Permalink to this headline">¶</a></h3>
<p>You already see that we can specify what each of the components
in the component chain are.
The way we set the source component to a monochromatic source is by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">source</span><span class="o">=</span><span class="n">MonochromaticSource</span>
</pre></div>
</div>
<p>And similarly, we can set the monitor</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">monitor</span><span class="o">=</span><span class="n">E_monitor</span>
</pre></div>
</div>
<p>To find out what are the component types you can use, run</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mcvine component list
</pre></div>
</div>
<p>You can also tell the command to list components in specific category. For example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mcvine component list --category=monitors
</pre></div>
</div>
<p>To find out more information about a specific component you are interested in,
run</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mcvine component info &lt;component-type&gt;
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mcvine component info E_monitor
</pre></div>
</div>
</div>
<div class="section" id="positions-of-components">
<h3>Positions of components<a class="headerlink" href="#positions-of-components" title="Permalink to this headline">¶</a></h3>
<p>Now, you could specify the position and orientation of a component by referring to “geometer”</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">geometer</span><span class="o">.</span><span class="n">monitor</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>The syntax is actually</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">geometer</span><span class="o">.</span><span class="n">monitor</span><span class="o">=&lt;</span><span class="n">position</span><span class="o">&gt;</span><span class="p">,</span><span class="o">&lt;</span><span class="n">orientation</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Position is a 3-vector, and the unit is meter.
Orientation is a 3-vector that denotes three consecutive rotations along
x, y, and z axes.
The unit is degrees.</p>
<p>More details can found in <a class="reference internal" href="Fundamentals.html#fundamentals-instrument-positioning-of-components"><span class="std std-ref">Positioning of Components</span></a>.</p>
</div>
<div class="section" id="configurations-of-components">
<h3>Configurations of components<a class="headerlink" href="#configurations-of-components" title="Permalink to this headline">¶</a></h3>
<p>Each component has several parameters that define the scattering properties of the
component. To find out the parameters for a component, use the command
“mcvine component info”</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mcvine component info E_monitor
</pre></div>
</div>
<p>The output would be</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">======================================================================</span>
<span class="n">E_monitor</span><span class="p">:</span> <span class="n">Energy</span><span class="o">-</span><span class="n">sensitive</span> <span class="n">monitor</span><span class="o">.</span>
<span class="o">----------------------------------------------------------------------</span>
<span class="n">A</span> <span class="n">square</span> <span class="n">single</span> <span class="n">monitor</span> <span class="n">that</span> <span class="n">measures</span> <span class="n">the</span> <span class="n">energy</span> <span class="n">of</span> <span class="n">the</span> <span class="n">incoming</span> <span class="n">neutrons</span><span class="o">.</span>

 <span class="n">Example</span><span class="p">:</span> <span class="n">E_monitor</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=-</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=-</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">Emin</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">Emax</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">nchan</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;Output.nrj&quot;</span><span class="p">)</span>


<span class="o">----------------------------------------------------------------------</span>
<span class="n">Parameters</span><span class="p">:</span>
  <span class="o">*</span> <span class="n">Emin</span><span class="p">:</span> <span class="n">Minimum</span> <span class="n">energy</span> <span class="n">to</span> <span class="n">detect</span> <span class="p">(</span><span class="n">meV</span><span class="p">)</span>
  <span class="o">*</span> <span class="n">Emax</span><span class="p">:</span> <span class="n">Maximum</span> <span class="n">energy</span> <span class="n">to</span> <span class="n">detect</span> <span class="p">(</span><span class="n">meV</span><span class="p">)</span>
  <span class="o">*</span> <span class="n">filename</span><span class="p">:</span> <span class="n">Name</span> <span class="n">of</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">which</span> <span class="n">to</span> <span class="n">store</span> <span class="n">the</span> <span class="n">detector</span> <span class="n">image</span> <span class="p">(</span><span class="n">text</span><span class="p">)</span>
  <span class="o">*</span> <span class="n">nchan</span><span class="p">:</span> <span class="n">Number</span> <span class="n">of</span> <span class="n">energy</span> <span class="n">channels</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="o">*</span> <span class="n">xmax</span><span class="p">:</span> <span class="n">Upper</span> <span class="n">x</span> <span class="n">bound</span> <span class="n">of</span> <span class="n">detector</span> <span class="n">opening</span> <span class="p">(</span><span class="n">m</span><span class="p">)</span>
  <span class="o">*</span> <span class="n">xmin</span><span class="p">:</span> <span class="n">Lower</span> <span class="n">x</span> <span class="n">bound</span> <span class="n">of</span> <span class="n">detector</span> <span class="n">opening</span> <span class="p">(</span><span class="n">m</span><span class="p">)</span>
  <span class="o">*</span> <span class="n">ymin</span><span class="p">:</span> <span class="n">Lower</span> <span class="n">y</span> <span class="n">bound</span> <span class="n">of</span> <span class="n">detector</span> <span class="n">opening</span> <span class="p">(</span><span class="n">m</span><span class="p">)</span>
  <span class="o">*</span> <span class="n">ymax</span><span class="p">:</span> <span class="n">Upper</span> <span class="n">y</span> <span class="n">bound</span> <span class="n">of</span> <span class="n">detector</span> <span class="n">opening</span> <span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="o">======================================================================</span>
</pre></div>
</div>
<p>If you want to change parameter “nchan”, for example, you will need</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">monitor</span><span class="o">.</span><span class="n">nchan</span><span class="o">=</span><span class="mi">10</span>
</pre></div>
</div>
<p>So here is what you may want to do when you run your simulation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./test --monitor.nchan=10
</pre></div>
</div>
<p>You can also see what  are the current parameters for the monitor by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./test --monitor.help-properties
</pre></div>
</div>
<p>Let us do a more careful configuration of the simulation and save
it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./test --source.energy=60 \
  --monitor.Emin=50 --monitor.Emax=70 --monitor.nchan=200 \
  --dump-pml
</pre></div>
</div>
<p>And then we can run it for a little while:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./test -ncount=1e4
</pre></div>
</div>
<p>When this command is run, output files will be generated
in a directory specified by option “–output-dir” which by default
is “out”. For this simulation, you should see a new file
“out/IE.h5”.
You can run command</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ PlotHist.py out/IE.h5
</pre></div>
</div>
<p>to see the output histogram.</p>
<a class="reference internal image-reference" href="_images/I(E).png"><img alt="_images/I(E).png" src="_images/I(E).png" style="width: 400px;" /></a>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li><a href="http://mcvine.org">MCViNE</a> &raquo; &nbsp;</li>
        <li><a href="index.html">Documentation</a> &raquo; &nbsp;</li>
        <li><a href="search.html">search</a> &raquo;</li>

        <li class="nav-item nav-item-this"><a href="">Tutorials – basics</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2006-2016, Jiao Lin, Michael Aivazis, and Brent Fultz.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.4.3.
    </div>
  </body>
</html>